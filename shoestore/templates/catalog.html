{% extends "base.html" %}
{% block content %}
  <h2>Catalog</h2>

  <form method="get" class="filters">
    <input type="text" name="q" placeholder="Search name/description" value="{{ filters.q or '' }}">

    <select name="color">
      <option value="">-- Any color --</option>
      <option value="black" {% if filters.color == "black" %}selected{% endif %}>Black</option>
      <option value="white" {% if filters.color == "white" %}selected{% endif %}>White</option>
      <option value="red" {% if filters.color == "red" %}selected{% endif %}>Red</option>
      <option value="green" {% if filters.color == "green" %}selected{% endif %}>Green</option>
      <option value="blue" {% if filters.color == "blue" %}selected{% endif %}>Blue</option>
      <option value="yellow" {% if filters.color == "yellow" %}selected{% endif %}>Yellow</option>
      <option value="brown" {% if filters.color == "brown" %}selected{% endif %}>Brown</option>
    </select>

    <input type="text" name="size" placeholder="Size" value="{{ filters.size or '' }}">
    <input type="number" step="0.01" name="min_price" placeholder="Min price" value="{{ filters.min_price if filters.min_price is not none else '' }}">
    <input type="number" step="0.01" name="max_price" placeholder="Max price" value="{{ filters.max_price if filters.max_price is not none else '' }}">
    <label>
      <input type="checkbox" name="in_stock" value="1" {% if filters.in_stock %}checked{% endif %}> In stock only
    </label>
    <button type="submit">Filter</button>
  </form>

  <div class="product-grid">
    {% for p in products %}
      <div class="product-card">
        <div class="product-image">
          <img src="{{ url_for('static', filename=p.image) }}" alt="{{ p.name }}">
        </div>

        <div class="product-info">
          <h3 class="product-name">{{ p.name }}</h3>
          <p class="product-desc">{{ p.description }}</p>
          <p class="product-meta">Color: {{ p.color }} | Sizes: {{ p.sizes|join(", ") }}</p>
          <p class="product-price">
            <span class="current-price">{{ "%.2f"|format(p.price) }} BGN</span>
            {% if p.old_price %}
              <span class="old-price">{{ "%.2f"|format(p.old_price) }} BGN</span>
            {% endif %}
          </p>
          <form action="{{ url_for('cart.add_to_cart', product_id=p.id) }}" method="post">
            <label>Quantity: <input type="number" name="quantity" value="1" min="1"></label>
            <br>
            <label>Size:
              <select name="size" required>
                {% for s in p.sizes %}
                  <option value="{{ s }}">{{ s }}</option>
                {% endfor %}
              </select>
            </label>
            <button type="submit" class="btn-add">Add to cart</button>
          </form>
        </div>
      </div>
    {% else %}
      <p>No products available.</p>
    {% endfor %}
  </div>
{% endblock %}
